<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Thực Hành Compiler Explorer: C → MIPS</title>
    <link rel="stylesheet" href="css/labs.css">

</head>
<body>
    <div class="container">

        <h1>Bài thực hành Biên dịch Trình C qua Hợp ngữ MIPS - Compiler Explorer</h1>

        <h2>Bài 3.1 – Làm quen Compiler Explorer và biên dịch mã C cơ bản</h2>
<div class="note-box">

  <h4>Mục tiêu</h4>
  <ol>
    <li>Làm quen giao diện web Compiler Explorer (https://godbolt.org).</li>
    <li>Biên dịch đoạn mã C và quan sát Assembly tương ứng.</li>
    <li>Hiểu sự tương quan giữa câu lệnh C và mã máy.</li>
  </ol>

  <h4>Công cụ</h4>
  <ol>
    <li>Trình duyệt Chrome / Edge / Cốc Cốc / …</li>
    <li>Trang web: https://godbolt.org</li>
    <li>Ngôn ngữ: C (compiler: gcc x86-64)</li>
  </ol>

  <h4>Hướng dẫn thực hiện (Step-by-Step)</h4>
  <ol>
    <li>
      Vào ứng dụng mô phỏng Kiến trúc máy tính:<br>
      <a href="https://thinhngo11.github.io/Computer-Architecture-Lab/MoPhongThucHanhKTMT.html" target="_blank">
        https://thinhngo11.github.io/Computer-Architecture-Lab/MoPhongThucHanhKTMT.html
      </a><br>
      Chọn “Biên dịch trình C qua hợp ngữ MIPS – Compiler Explorer”, chọn “Cách dùng” để xem hướng dẫn, sau đó chọn “Vào trình” để truy cập trang web https://godbolt.org và làm bài tập.
    </li>

    <li>Ở cửa sổ bên trái: chọn ngôn ngữ C; cửa sổ bên phải sẽ hiển thị Assembly.</li>

    <li>
      Gõ đoạn mã:
      <pre>
int add(int a, int b) {
    return a + b;
}
      </pre>
    </li>

    <li>Chọn compiler <b>gcc 15.2</b> với mức tối ưu <b>-O0</b> → Quan sát Assembly sinh ra.</li>

    <li>Ghi lại các lệnh Assembly chính (ví dụ: <code>mov</code>, <code>add</code>, <code>ret</code>).</li>
  </ol>

</div>

<h2>Bài 3.2 – Quan sát tác động của tối ưu (-O0 → -O3)</h2>
<div class="note-box">

  <h4>Mục tiêu</h4>
  <ol>
    <li>So sánh mã Assembly khi biên dịch với các mức tối ưu khác nhau.</li>
    <li>Hiểu cách compiler loại bỏ hoặc rút gọn câu lệnh.</li>
  </ol>

  <h4>Hướng dẫn</h4>
  <ol>
    <li>Vào ứng dụng mô phỏng Kiến trúc máy tính và chọn “Vào trình” để mở Compiler Explorer.</li>

    <li>
      Gõ mã:
      <pre>
int sum_array(int *a, int n) {
    int sum = 0;
    for (int i=0; i<n; i++)
        sum += a[i];
    return sum;
}
      </pre>
    </li>

    <li>Chạy với RISC-V (32-bit) gcc 15.2.0 → ghi số dòng Assembly.</li>
    <li>Chạy với RISC-V (32-bit) gcc 14.2.0 → ghi số dòng Assembly và nhận xét sự khác nhau.</li>
    <li>Quan sát các lệnh như <code>mov</code>, <code>add</code>, <code>cmp</code>, <code>jmp</code>, <code>lea</code>.</li>
  </ol>

  <h4>Câu hỏi ôn tập</h4>
  <ol>
    <li>Compiler bỏ vòng lặp trong trường hợp nào?</li>
    <li>Lệnh <code>lea</code> được dùng để làm gì?</li>
  </ol>
<h4>Câu hỏi ôn tập</h4>

  <ol>
    <li>Lệnh ret trong Assembly thực hiện chức năng gì?</li>
    <li>Sự khác biệt giữa -O0 và -O1 là gì?</li>
  </ol>
</div>



<h2>Bài 3.3 – Phân tích hàm đệ quy trong Assembly</h2>
<div class="note-box">

  <h4>Mục tiêu</h4>
  <ol>
    <li>Hiểu cách trình biên dịch triển khai đệ quy bằng ngăn xếp (stack).</li>
    <li>Theo dõi các lệnh gọi và trả về (<code>call</code>, <code>ret</code>).</li>
  </ol>

  <h4>Hướng dẫn</h4>
  <ol>
    <li>
      Mã C:
      <pre>
int fact(int n) {
    if (n <= 1) return 1;
    else return n * fact(n-1);
}
      </pre>
    </li>

    <li>Quan sát Assembly → tìm lệnh <code>call fact</code>.</li>
    <li>Chú ý các lệnh <code>push</code>, <code>pop</code> và sự thay đổi của stack frame.</li>
  </ol>

  <h4>Câu hỏi ôn tập</h4>
  <ol>
    <li>Vì sao mỗi lần gọi đệ quy phải lưu giá trị tạm vào stack?</li>
    <li>Nếu không có lệnh <code>ret</code>, chương trình sẽ xảy ra điều gì?</li>
  </ol>

</div>



<h2>Bài 3.4 – So sánh ngôn ngữ C và C++ trong mức Assembly</h2>
<div class="note-box">

  <h4>Mục tiêu</h4>
  <ol>
    <li>Hiểu sự khác biệt của mã biên dịch giữa C và C++.</li>
    <li>So sánh mã trước và sau khi sử dụng lớp (class).</li>
  </ol>

  <h4>Hướng dẫn</h4>
  <ol>
    <li>
      Mã C:
      <pre>
int add(int a, int b){ return a + b; }
      </pre>
    </li>

    <li>
      Mã C++:
      <pre>
class Calc {
public:
    int add(int a, int b){ return a + b; }
};
      </pre>
    </li>

    <li>Biên dịch cả hai → quan sát tên hàm (mangled symbol) trong C++, ví dụ: <code>_ZN4Calc3addEii</code>.</li>
  </ol>

  <h4>Câu hỏi ôn tập</h4>
  <ol>
    <li>Tại sao hàm C++ có tên “lạ” (name mangling)?</li>
    <li>Liên quan giữa OOP và tên mã máy là gì?</li>
  </ol>

</div>
<a href="MoPhongThucHanhKTMT.html" class="back-button">← Quay lại Trang chủ</a>
    </div>

</body>
</html>